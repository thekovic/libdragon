<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: Asset Subsystem</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo2.png"/></td>
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#files">Files</a>  </div>
  <div class="headertitle"><div class="title">Asset Subsystem<div class="ingroups"><a class="el" href="group__libdragon.html">libdragon</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Interfaces for loading assets from ROM or other supports.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="groups" name="groups"></a>
Modules</h2></td></tr>
<tr class="memitem:group__dfs"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__dfs.html">DragonFS</a></td></tr>
<tr class="memdesc:group__dfs"><td class="mdescLeft">&#160;</td><td class="mdescRight">DragonFS filesystem implementation and newlib hooks. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:asset_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="asset_8h.html">asset.h</a></td></tr>
<tr class="memdesc:asset_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Asset Subsystem. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Interfaces for loading assets from ROM or other supports. </p>
<p >The asset subsystem is in charge of loading assets. Typically, assets will be loaded from ROM, but other options might be possible (like SD cards).</p>
<p >Asset filenames are always prefixed with a filesystem identifier which has a syntax similar to an URL. For instance, to load a file from ROM through the DragonFS filesystem, use a filename like "rom:/myfile.txt".</p>
<p >While it is possible to simply open asset files using fopen, which supports the filesystem prefix as well, the asset subsystem provides a few helpers around asset compression.</p>
<p >Assets can be optionally compressed using the mkasset tool. Asset compression is done on a per-file basis (similar to how "gzip" works), and decompression is transparent to the user. The asset subsystem will automatically detect a compressed file and decompress it during loading.</p>
<p >The main functions for loading assets are <a class="el" href="asset_8h.html#abfc5939446d9920b884df034e89428a9" title="Load an asset file (possibly uncompressing it)">asset_load</a> and <a class="el" href="asset_8h.html#ac731b2beb346c99f36fa8f355fb84509" title="Open an asset file for reading (with transparent decompression)">asset_fopen</a>. <a class="el" href="asset_8h.html#abfc5939446d9920b884df034e89428a9" title="Load an asset file (possibly uncompressing it)">asset_load</a> loads the entire file into memory in one go, and it is useful for small files or in general files that has to fully keep in RAM as-is. The asset is transparently decompressed if needed.</p>
<p >Some files might require parsing during loading, and in that case, <a class="el" href="asset_8h.html#ac731b2beb346c99f36fa8f355fb84509" title="Open an asset file for reading (with transparent decompression)">asset_fopen</a> is provided. It returns a FILE* so that any kind of file operation can be performed on it, with transparent decompression. Since it is not possible to seek in a compressed file, the FILE* returned by <a class="el" href="asset_8h.html#ac731b2beb346c99f36fa8f355fb84509" title="Open an asset file for reading (with transparent decompression)">asset_fopen</a> will assert on seek, even if the file is not compressed (so that the user code will be ready for adding compression at any time).</p>
<p >If you know that the file will never be compressed and you absolutely need to freely seek, simply use the standard fopen() function.</p>
<h2><a class="anchor" id="autotoc_md33"></a>
Asset compression</h2>
<p >To compress your own data files, you can use the mkasset tool.</p>
<p >There are currently two compression levels:</p>
<ul>
<li>Level 1: this is based on LZ4 by Yann Collet. It is extremely fast and produce reasonable compression ratios. It is so fast at decompression that our implementation is typically faster at loading and decompressing a compressed asset, rather than loading it uncompressed. Libdragon tools will compress at level 1 by default.</li>
<li>Level 2: this is based on LZH5 by Haruhiko Okumura, part of the LHA archiver. It is slower than LZ4, but it produces better compression ratios. It has been measured to beat gzip/zlib for small files like those typically used on N64. Level 2 should be selected if there is a necessity to squeeze data at the maximum ratio, at the expense of loading speed.</li>
</ul>
<p >To minimize text siz and RAM usage, only the decompression code for level 1 is compiled by default. If you need to use level 2, you must call <a class="el" href="asset_8h.html#a6bdfd4d8e3a7e807dd7e1b8cb00332a4" title="Enable a non-default compression level.">asset_init_compression(2)</a>. </p>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
