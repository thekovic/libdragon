<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: exception.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo2.png"/></td>
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">exception.h File Reference<div class="ingroups"><a class="el" href="group__libdragon.html">libdragon</a> &raquo; <a class="el" href="group__lowlevel.html">Low Level Hardware Interfaces</a> &raquo; <a class="el" href="group__exceptions.html">Exception Handler</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Exception Handler.  
<a href="#details">More...</a></p>

<p><a href="exception_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structreg__block__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__exceptions.html#structreg__block__t">reg_block_t</a></td></tr>
<tr class="memdesc:structreg__block__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure representing a register block.  <a href="group__exceptions.html#structreg__block__t">More...</a><br /></td></tr>
<tr class="separator:structreg__block__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structexception__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__exceptions.html#structexception__t">exception_t</a></td></tr>
<tr class="memdesc:structexception__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure representing an exception.  <a href="group__exceptions.html#structexception__t">More...</a><br /></td></tr>
<tr class="separator:structexception__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:unionreg__block__t_8____unnamed33____"><td class="memItemLeft" align="right" valign="top">union &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__exceptions.html#unionreg__block__t_8____unnamed33____">reg_block_t.__unnamed33__</a></td></tr>
<tr class="memdesc:unionreg__block__t_8____unnamed33____"><td class="mdescLeft">&#160;</td><td class="mdescRight">General purpose registers 1-32.  <a href="group__exceptions.html#unionreg__block__t_8____unnamed33____">More...</a><br /></td></tr>
<tr class="separator:unionreg__block__t_8____unnamed33____"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structreg__block__t_8____unnamed33_____8____unnamed35____"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__exceptions.html#structreg__block__t_8____unnamed33_____8____unnamed35____">reg_block_t.__unnamed33__.__unnamed35__</a></td></tr>
<tr class="separator:structreg__block__t_8____unnamed33_____8____unnamed35____"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a4296110877efb56862a467ee1ab633bd"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">exception_handler_t</a>) (<a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *exc)</td></tr>
<tr class="memdesc:a4296110877efb56862a467ee1ab633bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generic exception handler.  <a href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">More...</a><br /></td></tr>
<tr class="separator:a4296110877efb56862a467ee1ab633bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aceadbbfdaee48a1075dac31bddc20d1c"><td class="memItemLeft" align="right" valign="top">typedef void(*&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exception_8h.html#aceadbbfdaee48a1075dac31bddc20d1c">syscall_handler_t</a>) (<a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *exc, uint32_t code)</td></tr>
<tr class="memdesc:aceadbbfdaee48a1075dac31bddc20d1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Syscall handler.  <a href="exception_8h.html#aceadbbfdaee48a1075dac31bddc20d1c">More...</a><br /></td></tr>
<tr class="separator:aceadbbfdaee48a1075dac31bddc20d1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="enum-members" name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga0944a4353780132eeab7b06e3e42291d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <a class="el" href="group__exceptions.html#gga0944a4353780132eeab7b06e3e42291da90b2b2223067700d2015835a712151ba">EXCEPTION_TYPE_UNKNOWN</a> = 0
, <a class="el" href="group__exceptions.html#gga0944a4353780132eeab7b06e3e42291da8193732583ae3c307371a55998620919">EXCEPTION_TYPE_RESET</a>
, <a class="el" href="group__exceptions.html#gga0944a4353780132eeab7b06e3e42291da4512100e37620ac5e38279290ced9245">EXCEPTION_TYPE_CRITICAL</a>
, <a class="el" href="group__exceptions.html#gga0944a4353780132eeab7b06e3e42291da782e43cc570f9717fd4bbb6c16211826">EXCEPTION_TYPE_SYSCALL</a>
 }</td></tr>
<tr class="memdesc:ga0944a4353780132eeab7b06e3e42291d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Exception types.  <a href="group__exceptions.html#ga0944a4353780132eeab7b06e3e42291d">More...</a><br /></td></tr>
<tr class="separator:ga0944a4353780132eeab7b06e3e42291d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga402ebff4d96f276dd02c0159707849a3"><td class="memItemLeft" align="right" valign="top"><a id="ga402ebff4d96f276dd02c0159707849a3" name="ga402ebff4d96f276dd02c0159707849a3"></a>enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__exceptions.html#ga402ebff4d96f276dd02c0159707849a3">exception_code_t</a> { <br />
&#160;&#160;<b>EXCEPTION_CODE_INTERRUPT</b> = 0
, <b>EXCEPTION_CODE_TLB_MODIFICATION</b> = 1
, <b>EXCEPTION_CODE_TLB_LOAD_I_MISS</b> = 2
, <b>EXCEPTION_CODE_TLB_STORE_MISS</b> = 3
, <br />
&#160;&#160;<b>EXCEPTION_CODE_LOAD_I_ADDRESS_ERROR</b> = 4
, <b>EXCEPTION_CODE_STORE_ADDRESS_ERROR</b> = 5
, <b>EXCEPTION_CODE_I_BUS_ERROR</b> = 6
, <b>EXCEPTION_CODE_D_BUS_ERROR</b> = 7
, <br />
&#160;&#160;<b>EXCEPTION_CODE_SYS_CALL</b> = 8
, <b>EXCEPTION_CODE_BREAKPOINT</b> = 9
, <b>EXCEPTION_CODE_RESERVED_INSTRUCTION</b> = 10
, <b>EXCEPTION_CODE_COPROCESSOR_UNUSABLE</b> = 11
, <br />
&#160;&#160;<b>EXCEPTION_CODE_ARITHMETIC_OVERFLOW</b> = 12
, <b>EXCEPTION_CODE_TRAP</b> = 13
, <b>EXCEPTION_CODE_FLOATING_POINT</b> = 15
, <b>EXCEPTION_CODE_WATCH</b> = 23
<br />
 }</td></tr>
<tr class="memdesc:ga402ebff4d96f276dd02c0159707849a3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Exception codes. <br /></td></tr>
<tr class="separator:ga402ebff4d96f276dd02c0159707849a3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a20f7ab774d736160a00431ccaf8636a6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">exception_handler_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exception_8h.html#a20f7ab774d736160a00431ccaf8636a6">register_exception_handler</a> (<a class="el" href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">exception_handler_t</a> cb)</td></tr>
<tr class="memdesc:a20f7ab774d736160a00431ccaf8636a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register an exception handler to handle exceptions.  <a href="exception_8h.html#a20f7ab774d736160a00431ccaf8636a6">More...</a><br /></td></tr>
<tr class="separator:a20f7ab774d736160a00431ccaf8636a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2ccc97f57a66f0091daa6529c4f52573"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exception_8h.html#a2ccc97f57a66f0091daa6529c4f52573">exception_default_handler</a> (<a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *ex)</td></tr>
<tr class="memdesc:a2ccc97f57a66f0091daa6529c4f52573"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default exception handler.  <a href="exception_8h.html#a2ccc97f57a66f0091daa6529c4f52573">More...</a><br /></td></tr>
<tr class="separator:a2ccc97f57a66f0091daa6529c4f52573"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84782b20b1cf9cec7ca102080962c965"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="exception_8h.html#a84782b20b1cf9cec7ca102080962c965">register_syscall_handler</a> (<a class="el" href="exception_8h.html#aceadbbfdaee48a1075dac31bddc20d1c">syscall_handler_t</a> handler, uint32_t first_code, uint32_t last_code)</td></tr>
<tr class="memdesc:a84782b20b1cf9cec7ca102080962c965"><td class="mdescLeft">&#160;</td><td class="mdescRight">Register a handler that will be called when a syscall exception.  <a href="exception_8h.html#a84782b20b1cf9cec7ca102080962c965">More...</a><br /></td></tr>
<tr class="separator:a84782b20b1cf9cec7ca102080962c965"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Exception Handler. </p>
</div><h2 class="groupheader">Typedef Documentation</h2>
<a id="a4296110877efb56862a467ee1ab633bd" name="a4296110877efb56862a467ee1ab633bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4296110877efb56862a467ee1ab633bd">&#9670;&nbsp;</a></span>exception_handler_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* exception_handler_t) (<a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *exc)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Generic exception handler. </p>
<p >This is the type of a handler that can be registered using <a class="el" href="exception_8h.html#a20f7ab774d736160a00431ccaf8636a6" title="Register an exception handler to handle exceptions.">register_exception_handler</a>. It is associated to all unhandled exceptions that are not otherwise handled by libdragon.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exc</td><td>Exception information </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aceadbbfdaee48a1075dac31bddc20d1c" name="aceadbbfdaee48a1075dac31bddc20d1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aceadbbfdaee48a1075dac31bddc20d1c">&#9670;&nbsp;</a></span>syscall_handler_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef void(* syscall_handler_t) (<a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *exc, uint32_t code)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Syscall handler. </p>
<p >This is the type of a handler of a syscall exception.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">exc</td><td>Exception information </td></tr>
    <tr><td class="paramname">code</td><td>Syscall code </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a20f7ab774d736160a00431ccaf8636a6" name="a20f7ab774d736160a00431ccaf8636a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a20f7ab774d736160a00431ccaf8636a6">&#9670;&nbsp;</a></span>register_exception_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">exception_handler_t</a> register_exception_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="exception_8h.html#a4296110877efb56862a467ee1ab633bd">exception_handler_t</a>&#160;</td>
          <td class="paramname"><em>cb</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register an exception handler to handle exceptions. </p>
<p >The registered handle is responsible for clearing any bits that may cause a re-trigger of the same exception and updating the EPC. An important example is the cause bits (12-17) of FCR31 from cop1. To prevent re-triggering the exception they should be cleared by the handler.</p>
<p >To manipulate the registers, update the values in the <a class="el" href="group__exceptions.html#structexception__t" title="Structure representing an exception.">exception_t</a> struct. They will be restored to appropriate locations when returning from the handler. Setting them directly will not work as expected as they will get overwritten with the values pointed by the struct.</p>
<p >There is only one exception to this, cr (cause register) which is also modified by the int handler before the saved values are restored thus it is only possible to update it through C0_WRITE_CR macro if it is needed. This shouldn't be necessary though as they are already handled by the library.</p>
<p >k0 ($26), k1 ($27) are not saved/restored and will not be available in the handler. Theoretically we can exclude s0-s7 ($16-$23), and gp ($28) to gain some performance as they are already saved by GCC when necessary. The same is true for sp ($29) and ra ($31) but current interrupt handler manipulates them via allocating a new stack and doing a jal. Similarly floating point registers f21-f31 are callee-saved. In the future we may consider removing them from the save state for interrupts (but not for exceptions)</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">cb</td><td>Callback function to call when exceptions happen </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a2ccc97f57a66f0091daa6529c4f52573" name="a2ccc97f57a66f0091daa6529c4f52573"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ccc97f57a66f0091daa6529c4f52573">&#9670;&nbsp;</a></span>exception_default_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void exception_default_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__exceptions.html#structexception__t">exception_t</a> *&#160;</td>
          <td class="paramname"><em>ex</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Default exception handler. </p>
<p >This handler is installed by default for all exceptions. It initializes the console and dump the exception state to the screen, including the value of all GPR/FPR registers. It then calls abort() to abort execution. </p>

</div>
</div>
<a id="a84782b20b1cf9cec7ca102080962c965" name="a84782b20b1cf9cec7ca102080962c965"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a84782b20b1cf9cec7ca102080962c965">&#9670;&nbsp;</a></span>register_syscall_handler()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void register_syscall_handler </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="exception_8h.html#aceadbbfdaee48a1075dac31bddc20d1c">syscall_handler_t</a>&#160;</td>
          <td class="paramname"><em>handler</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>first_code</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>last_code</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Register a handler that will be called when a syscall exception. </p>
<p >This function allows to register a handler to be invoked in response to a syscall exception, generated by the SYSCALL opcode. The opcode allows to specify a 20-bit code which, in a more traditional operating system architecture, corresponds to the "service" to be called.</p>
<p >When the registered handler returns, the execution will resume from the instruction following the syscall one.</p>
<p >To allow for different usages of the code field, this function accepts a range of codes to associated with the handler. This allows a single handler to be invoked for multiple different codes, to specialize services.</p>
<dl class="section note"><dt>Note</dt><dd>Syscall codes in the range 0x00000 - 0x0FFFF are reserved to libdragon itself. Use a code outside that range to avoid conflicts with future versions of libdragon.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">handler</td><td>Handler to invoke when a syscall exception is triggered </td></tr>
    <tr><td class="paramname">first_code</td><td>First syscall code to associate with this handler (begin of range) </td></tr>
    <tr><td class="paramname">last_code</td><td>Last syscall code to associate with this handler (end of range) </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
