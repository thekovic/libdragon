<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: Fast math routines</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo2.png"/></td>
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle"><div class="title">Fast math routines<div class="ingroups"><a class="el" href="group__libdragon.html">libdragon</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>Fast math routines, optimized for 3D graphics calculations.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:fmath_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fmath_8c.html">fmath.c</a></td></tr>
<tr class="memdesc:fmath_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fast math routines, optimized for 3D graphics calculations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:fmath_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="fmath_8h.html">fmath.h</a></td></tr>
<tr class="memdesc:fmath_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fast math routines, optimized for 3D graphics calculations. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Fast math routines, optimized for 3D graphics calculations. </p>
<p >This module collects mathematical functions operating a single-precision floating point numbers (float) that are useful in the context of 3D graphics algorithm. The provided algorithms have prototypes that are identical to the C standard ones (provided by libm), but their implementation has been optimized in a way that is normally useful in the context of graphics programming in games. In particular, compared to the C standard:</p>
<ul>
<li>Infinites are not handled, the resulting value is undefined.</li>
<li>Signed zeros are not respected.</li>
<li>Denormals are not handled (also because the VR3000 is unable to produce them, and it is configured to flush them to zero, see cop1.c).</li>
<li>errno is never generated or modified.</li>
<li>The numerical error is much higher than 1 ULP, but still much smaller than that introduced by converting floating point values into the fixed point representation required by RSP. Obviously, errors in numbers accumulate over multiple calculations, but the idea is that they should still stay small enough to rarely affect what it is being sent to RSP.</li>
</ul>
<p >The first four compromises above are similar and in-line with those that are usually accepted by programmers that compile their floating point code using <code>-ffast-math</code>.</p>
<p >As for the numerical error, there is no single good trade-off that can be generally taken when deciding how much we want to approximate an inverse square root or a trigonometric function. Using the general understanding that most 3D games on N64 are fill-rate limited rather than CPU or RSP limited, this library stays on the side of spending more CPU cycles more than the most basic version, while still offering a couple of orders of magnitudes of speed improvement over the standard C versions (that are fully accurate for all inputs).</p>
<p >All the functions defined by this library prefixed with "fm_" (eg: <a class="el" href="fmath_8h.html#ac0a97f3dfd3b642796b582bba56b1c4b" title="Faster version of sinf.">fm_sinf</a>). It is possible to define the preprocess macro LIBDRAGON_FAST_MATH to additionally define macros that override the standard library functions, so that calling <code>sinf(x)</code> will actually invoke <code>fm_sinf(x)</code>.</p>
<p >The following C99 functions have been tested and the default implementation is already very good (eg: they are intrinsified):</p>
<ul>
<li>fabsf</li>
<li>copysignf</li>
<li>sqrtf (uses the sqrt.s opcode). Also 1.0f/sqrtf(x) is fast enough not to worry about using a fast inverse square root. </li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
