<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libdragon: rdpq_internal.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libdragon
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="dir_e82f31e8932771ae6769214a98ceba7f.html">rdpq</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle"><div class="title">rdpq_internal.h File Reference<div class="ingroups"><a class="el" href="group__libdragon.html">libdragon</a> &raquo; <a class="el" href="group__display.html">Display Subsystem</a> &raquo; <a class="el" href="group__rdp.html">(Deprecated) Old RDP library</a></div></div></div>
</div><!--header-->
<div class="contents">

<p>RDP Command queue: internal functions.  
<a href="#details">More...</a></p>

<p><a href="rdpq__internal_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr class="memitem:structrdpq__tracking__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#structrdpq__tracking__t">rdpq_tracking_t</a></td></tr>
<tr class="memdesc:structrdpq__tracking__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">RDP tracking state.  <a href="rdpq__internal_8h.html#structrdpq__tracking__t">More...</a><br /></td></tr>
<tr class="separator:structrdpq__tracking__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structrdpq__block__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a></td></tr>
<tr class="memdesc:structrdpq__block__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">A buffer that piggybacks onto <a class="el" href="rspq__internal_8h.html#structrspq__block__t" title="A rspq block: pre-recorded array of commands.">rspq_block_t</a> to store RDP commands.  <a href="rdpq__internal_8h.html#structrdpq__block__t">More...</a><br /></td></tr>
<tr class="separator:structrdpq__block__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:structrdpq__block__state__t"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#structrdpq__block__state__t">rdpq_block_state_t</a></td></tr>
<tr class="memdesc:structrdpq__block__state__t"><td class="mdescLeft">&#160;</td><td class="mdescRight">RDP block management state.  <a href="rdpq__internal_8h.html#structrdpq__block__state__t">More...</a><br /></td></tr>
<tr class="separator:structrdpq__block__state__t"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a2ea7458c96e94aa5fe7481e3f679a4c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a2ea7458c96e94aa5fe7481e3f679a4c4">rdpq_passthrough_write</a>(rdp_cmd)</td></tr>
<tr class="memdesc:a2ea7458c96e94aa5fe7481e3f679a4c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a passthrough RDP command into the rspq queue.  <a href="rdpq__internal_8h.html#a2ea7458c96e94aa5fe7481e3f679a4c4">More...</a><br /></td></tr>
<tr class="separator:a2ea7458c96e94aa5fe7481e3f679a4c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeb872b5dba9db3ba975bf2b3b8282e71"><td class="memItemLeft" align="right" valign="top"><a id="aeb872b5dba9db3ba975bf2b3b8282e71" name="aeb872b5dba9db3ba975bf2b3b8282e71"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>rdpq_fence</b> (void)</td></tr>
<tr class="memdesc:aeb872b5dba9db3ba975bf2b3b8282e71"><td class="mdescLeft">&#160;</td><td class="mdescRight">Public rdpq_fence API, redefined it. <br /></td></tr>
<tr class="separator:aeb872b5dba9db3ba975bf2b3b8282e71"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e7cc732c607a8a3182c510e6c643fc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a5e7cc732c607a8a3182c510e6c643fc6">__rdpq_block_begin</a> ()</td></tr>
<tr class="memdesc:a5e7cc732c607a8a3182c510e6c643fc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize RDP block mangament.  <a href="rdpq__internal_8h.html#a5e7cc732c607a8a3182c510e6c643fc6">More...</a><br /></td></tr>
<tr class="separator:a5e7cc732c607a8a3182c510e6c643fc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e87bea5a505bd42b36b0bd750b8c9c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a0e87bea5a505bd42b36b0bd750b8c9c2">__rdpq_block_end</a> ()</td></tr>
<tr class="memdesc:a0e87bea5a505bd42b36b0bd750b8c9c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Finish creation of a RDP block.  <a href="rdpq__internal_8h.html#a0e87bea5a505bd42b36b0bd750b8c9c2">More...</a><br /></td></tr>
<tr class="separator:a0e87bea5a505bd42b36b0bd750b8c9c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a95f193ed65ef91d46599c3ca7edb1cc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a95f193ed65ef91d46599c3ca7edb1cc6">__rdpq_block_free</a> (<a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *block)</td></tr>
<tr class="memdesc:a95f193ed65ef91d46599c3ca7edb1cc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a block.  <a href="rdpq__internal_8h.html#a95f193ed65ef91d46599c3ca7edb1cc6">More...</a><br /></td></tr>
<tr class="separator:a95f193ed65ef91d46599c3ca7edb1cc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7e9fde5a3babeec454eb8ea92f390601"><td class="memItemLeft" align="right" valign="top"><a id="a7e9fde5a3babeec454eb8ea92f390601" name="a7e9fde5a3babeec454eb8ea92f390601"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>__rdpq_block_run</b> (<a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *block)</td></tr>
<tr class="memdesc:a7e9fde5a3babeec454eb8ea92f390601"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run a block (called by <a class="el" href="rspq_8h.html#ad078c001303a1b2153ba99f3184194f3" title="Add to the RSP queue a command that runs a block.">rspq_block_run</a>). <br /></td></tr>
<tr class="separator:a7e9fde5a3babeec454eb8ea92f390601"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab0187e0dcc3e6ef22ec15a36eabe1102"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#ab0187e0dcc3e6ef22ec15a36eabe1102">__rdpq_block_next_buffer</a> (void)</td></tr>
<tr class="memdesc:ab0187e0dcc3e6ef22ec15a36eabe1102"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a new RDP block buffer, chaining it to the current one (if any)  <a href="rdpq__internal_8h.html#ab0187e0dcc3e6ef22ec15a36eabe1102">More...</a><br /></td></tr>
<tr class="separator:ab0187e0dcc3e6ef22ec15a36eabe1102"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af94e0a9672c6ee667c9da808183cee7b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#af94e0a9672c6ee667c9da808183cee7b">__rdpq_block_update</a> (volatile uint32_t *wptr)</td></tr>
<tr class="memdesc:af94e0a9672c6ee667c9da808183cee7b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set a new RDP write pointer, and enqueue a RSP command to run the buffer until there.  <a href="rdpq__internal_8h.html#af94e0a9672c6ee667c9da808183cee7b">More...</a><br /></td></tr>
<tr class="separator:af94e0a9672c6ee667c9da808183cee7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f78d017798b8072f8006423f506e5f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#aa6f78d017798b8072f8006423f506e5f">__rdpq_block_reserve</a> (int num_rdp_commands)</td></tr>
<tr class="memdesc:aa6f78d017798b8072f8006423f506e5f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserve space in the RDP static buffer for a number of RDP commands.  <a href="rdpq__internal_8h.html#aa6f78d017798b8072f8006423f506e5f">More...</a><br /></td></tr>
<tr class="separator:aa6f78d017798b8072f8006423f506e5f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a28b29465b8849ddd6164c82e5136d9fc"><td class="memItemLeft" align="right" valign="top"><a id="a28b29465b8849ddd6164c82e5136d9fc" name="a28b29465b8849ddd6164c82e5136d9fc"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>__rdpq_autosync_use</b> (uint32_t res)</td></tr>
<tr class="memdesc:a28b29465b8849ddd6164c82e5136d9fc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Autosync engine: mark certain resources as in use. <br /></td></tr>
<tr class="separator:a28b29465b8849ddd6164c82e5136d9fc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a160540e0fbb288415a097fdbde5b8812"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a160540e0fbb288415a097fdbde5b8812">__rdpq_autosync_change</a> (uint32_t res)</td></tr>
<tr class="memdesc:a160540e0fbb288415a097fdbde5b8812"><td class="mdescLeft">&#160;</td><td class="mdescRight">Autosync engine: mark certain resources as being changed.  <a href="rdpq__internal_8h.html#a160540e0fbb288415a097fdbde5b8812">More...</a><br /></td></tr>
<tr class="separator:a160540e0fbb288415a097fdbde5b8812"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aee535835045a8c36477418f77240effe"><td class="memItemLeft" align="right" valign="top"><a id="aee535835045a8c36477418f77240effe" name="aee535835045a8c36477418f77240effe"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>__rdpq_write8</b> (uint32_t cmd_id, uint32_t arg0, uint32_t arg1)</td></tr>
<tr class="memdesc:aee535835045a8c36477418f77240effe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a standard 8-byte RDP command. <br /></td></tr>
<tr class="separator:aee535835045a8c36477418f77240effe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8b69979da879d66599898b973d2932d4"><td class="memItemLeft" align="right" valign="top"><a id="a8b69979da879d66599898b973d2932d4" name="a8b69979da879d66599898b973d2932d4"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>__rdpq_write16</b> (uint32_t cmd_id, uint32_t arg0, uint32_t arg1, uint32_t arg2, uint32_t arg3)</td></tr>
<tr class="memdesc:a8b69979da879d66599898b973d2932d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Write a standard 16-byte RDP command <br  />
 <br /></td></tr>
<tr class="separator:a8b69979da879d66599898b973d2932d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add1e792a78af68f486e3c73e74faee77"><td class="memItemLeft" align="right" valign="top"><a id="add1e792a78af68f486e3c73e74faee77" name="add1e792a78af68f486e3c73e74faee77"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>rdpq_triangle_cpu</b> (const <a class="el" href="structrdpq__trifmt__t.html">rdpq_trifmt_t</a> *fmt, const float *v1, const float *v2, const float *v3)</td></tr>
<tr class="memdesc:add1e792a78af68f486e3c73e74faee77"><td class="mdescLeft">&#160;</td><td class="mdescRight">RDP triangle primitive assembled on the CPU. <br /></td></tr>
<tr class="separator:add1e792a78af68f486e3c73e74faee77"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78b920a91e60da1f3abea7e23cfea43b"><td class="memItemLeft" align="right" valign="top"><a id="a78b920a91e60da1f3abea7e23cfea43b" name="a78b920a91e60da1f3abea7e23cfea43b"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>rdpq_triangle_rsp</b> (const <a class="el" href="structrdpq__trifmt__t.html">rdpq_trifmt_t</a> *fmt, const float *v1, const float *v2, const float *v3)</td></tr>
<tr class="memdesc:a78b920a91e60da1f3abea7e23cfea43b"><td class="mdescLeft">&#160;</td><td class="mdescRight">RDP triangle primitive assembled on the RSP. <br /></td></tr>
<tr class="separator:a78b920a91e60da1f3abea7e23cfea43b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a31b230c610daa5f50adaa7323ea2698b"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="rdpq__internal_8h.html#a31b230c610daa5f50adaa7323ea2698b">__rdpq_inited</a></td></tr>
<tr class="memdesc:a31b230c610daa5f50adaa7323ea2698b"><td class="mdescLeft">&#160;</td><td class="mdescRight">True if the rdpq module was inited.  <a href="rdpq__internal_8h.html#a31b230c610daa5f50adaa7323ea2698b">More...</a><br /></td></tr>
<tr class="separator:a31b230c610daa5f50adaa7323ea2698b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8056a83469cbf54042ddf897d474c7cc"><td class="memItemLeft" align="right" valign="top"><a id="a8056a83469cbf54042ddf897d474c7cc" name="a8056a83469cbf54042ddf897d474c7cc"></a>
<a class="el" href="rdpq__internal_8h.html#structrdpq__tracking__t">rdpq_tracking_t</a>&#160;</td><td class="memItemRight" valign="bottom"><b>rdpq_tracking</b></td></tr>
<tr class="memdesc:a8056a83469cbf54042ddf897d474c7cc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tracking state of RDP. <br /></td></tr>
<tr class="separator:a8056a83469cbf54042ddf897d474c7cc"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >RDP Command queue: internal functions. </p>
</div><hr/><h2 class="groupheader">Data Structure Documentation</h2>
<a name="structrdpq__tracking__t" id="structrdpq__tracking__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structrdpq__tracking__t">&#9670;&nbsp;</a></span>rdpq_tracking_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct rdpq_tracking_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >RDP tracking state. </p>
<p >This structure contains information that refer to the state of the RDP, tracked by the CPU as it enqueues RDP instructions.ì</p>
<p >Tracking the RDP state on the CPU is in general possible (as all RDP commands are supposed to go through rdpq, when it is used), but it doesn't fully work across blocks. In fact, blocks can be called in multiple call sites with different RDP states, so it would be wrong to do any assumption on the RDP state while generating the block.</p>
<p >Thus, this structure is reset at some default by <a class="el" href="rdpq__internal_8h.html#a5e7cc732c607a8a3182c510e6c643fc6" title="Initialize RDP block mangament.">__rdpq_block_begin</a>, and then its previous state is restored by <a class="el" href="rdpq__internal_8h.html#a0e87bea5a505bd42b36b0bd750b8c9c2" title="Finish creation of a RDP block.">__rdpq_block_end</a>. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a8d2ac563cf98083991bcf5b730539121" name="a8d2ac563cf98083991bcf5b730539121"></a>uint32_t</td>
<td class="fieldname">
autosync: 17</td>
<td class="fielddoc">
State of the autosync engine. <p >The state of the autosync engine is a 32-bit word, where bits are mapped to specific internal resources of the RDP that might be in use. The mapping of the bits is indicated by the <code>AUTOSYNC_TILE</code>, <code>AUTOSYNC_TMEM</code>, and <code>AUTOSYNC_PIPE</code></p>
<p >When a bit is set to 1, the corresponding resource is "in use" by the RDP. For instance, drawing a textured rectangle can use a tile and the pipe (which contains most of the mode registers). </p>
</td></tr>
<tr><td class="fieldtype">
<a id="ab8bd2c9579eae6b3e65b80a66881a4bf" name="ab8bd2c9579eae6b3e65b80a66881a4bf"></a>bool</td>
<td class="fieldname">
mode_freeze: 1</td>
<td class="fielddoc">
True if the mode changes are currently frozen. </td></tr>
<tr><td class="fieldtype">
<a id="a4aa79ee88fa2c3413de5283bda88d3b3" name="a4aa79ee88fa2c3413de5283bda88d3b3"></a>uint8_t</td>
<td class="fieldname">
cycle_type_known: 2</td>
<td class="fielddoc">
0=unknown, 1=standard, 2=copy/fill <br  />
 </td></tr>
<tr><td class="fieldtype">
<a id="a6c60709d54dc757f9c074ed78edfef2a" name="a6c60709d54dc757f9c074ed78edfef2a"></a>uint8_t</td>
<td class="fieldname">
cycle_type_frozen: 2</td>
<td class="fielddoc">
</td></tr>
</table>

</div>
</div>
<a name="structrdpq__block__t" id="structrdpq__block__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structrdpq__block__t">&#9670;&nbsp;</a></span>rdpq_block_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct rdpq_block_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >A buffer that piggybacks onto <a class="el" href="rspq__internal_8h.html#structrspq__block__t" title="A rspq block: pre-recorded array of commands.">rspq_block_t</a> to store RDP commands. </p>
<p >In rspq blocks, raw RDP commands are not stored as passthroughs for performance. Instead, they are stored in a parallel buffer in RDRAM and the RSP block contains commands to send (portions of) this buffer directly to RDP via DMA. This saves memory bandwidth compared to doing passthrough for every command.</p>
<p >Since the buffer can grow during creation, it is stored as a linked list of buffers. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a548817d3696c1da809c44e1d250e9382" name="a548817d3696c1da809c44e1d250e9382"></a><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *</td>
<td class="fieldname">
next</td>
<td class="fielddoc">
Link to next buffer (or NULL if this is the last one for this block) </td></tr>
<tr><td class="fieldtype">
<a id="a08c78c66ef730357d9cf87faace544b6" name="a08c78c66ef730357d9cf87faace544b6"></a><a class="el" href="rdpq__internal_8h.html#structrdpq__tracking__t">rdpq_tracking_t</a></td>
<td class="fieldname">
tracking</td>
<td class="fielddoc">
Tracking state at the end of a block (this is populated only on the first link) </td></tr>
<tr><td class="fieldtype">
<a id="a7cc584a00d06bc0c4c318341d754f421" name="a7cc584a00d06bc0c4c318341d754f421"></a>uint32_t</td>
<td class="fieldname">
cmds[]</td>
<td class="fielddoc">
RDP commands. </td></tr>
</table>

</div>
</div>
<a name="structrdpq__block__state__t" id="structrdpq__block__state__t"></a>
<h2 class="memtitle"><span class="permalink"><a href="#structrdpq__block__state__t">&#9670;&nbsp;</a></span>rdpq_block_state_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct rdpq_block_state_t</td>
        </tr>
      </table>
</div><div class="memdoc">
<div class="textblock"><p >RDP block management state. </p>
<p >This is the internal state used by <a class="el" href="rdpq_8c.html" title="RDP Command queue.">rdpq.c</a> to manage block creation. </p>
</div><table class="fieldtable">
<tr><th colspan="3">Data Fields</th></tr>
<tr><td class="fieldtype">
<a id="a24531af975b9a59f55b24893f0040923" name="a24531af975b9a59f55b24893f0040923"></a>volatile uint32_t *</td>
<td class="fieldname">
wptr</td>
<td class="fielddoc">
During block creation, current write pointer within the RDP buffer. </td></tr>
<tr><td class="fieldtype">
<a id="ac8a666ee0e841824dc4ade0bae5dcfe7" name="ac8a666ee0e841824dc4ade0bae5dcfe7"></a>volatile uint32_t *</td>
<td class="fieldname">
wend</td>
<td class="fielddoc">
During block creation, pointer to the end of the RDP buffer. </td></tr>
<tr><td class="fieldtype">
<a id="ac0a5abf615bbee7059f1be497390009a" name="ac0a5abf615bbee7059f1be497390009a"></a>volatile uint32_t *</td>
<td class="fieldname">
pending_wptr</td>
<td class="fielddoc">
Previous wptr, swapped out to go back to dynamic buffer. </td></tr>
<tr><td class="fieldtype">
<a id="a7687d6ec7ce2fa0eaf74089a7001e876" name="a7687d6ec7ce2fa0eaf74089a7001e876"></a>volatile uint32_t *</td>
<td class="fieldname">
pending_wend</td>
<td class="fielddoc">
Previous wend, swapped out to go back to dynamic buffer. </td></tr>
<tr><td class="fieldtype">
<a id="a9c220861365aa11e63a1168209bf11b4" name="a9c220861365aa11e63a1168209bf11b4"></a><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *</td>
<td class="fieldname">
last_node</td>
<td class="fielddoc">
Point to the RDP block being created. </td></tr>
<tr><td class="fieldtype">
<a id="ac3c4289a980c4085f66b794a4efef7ec" name="ac3c4289a980c4085f66b794a4efef7ec"></a><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *</td>
<td class="fieldname">
first_node</td>
<td class="fielddoc">
Point to the first link of the RDP block being created. </td></tr>
<tr><td class="fieldtype">
<a id="af42878be81475526a351ffd16d9afa90" name="af42878be81475526a351ffd16d9afa90"></a>int</td>
<td class="fieldname">
bufsize</td>
<td class="fielddoc">
Current buffer size for RDP blocks. </td></tr>
<tr><td class="fieldtype">
<a id="ae387ea48068f1908da56615198e6f7d9" name="ae387ea48068f1908da56615198e6f7d9"></a>volatile uint32_t *</td>
<td class="fieldname">
last_rdp_append_buffer</td>
<td class="fielddoc">
<p >During block creation, this variable points to the last <a class="el" href="rspq__internal_8h.html#aba01db17f4a2bfbc3db60dc172972a25abe06e92ff0ad671b894d7406f36caf6a" title="RSPQ Command: send more data to RDP (appended to the end of the current buffer)">RSPQ_CMD_RDP_APPEND_BUFFER</a> command, that can be coalesced in case a pure RDP command is enqueued next. </p>
</td></tr>
<tr><td class="fieldtype">
<a id="af2c4ae75ec42618a26ac2871fedb65ec" name="af2c4ae75ec42618a26ac2871fedb65ec"></a><a class="el" href="rdpq__internal_8h.html#structrdpq__tracking__t">rdpq_tracking_t</a></td>
<td class="fieldname">
previous_tracking</td>
<td class="fielddoc">
Tracking state before starting building the block. </td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a2ea7458c96e94aa5fe7481e3f679a4c4" name="a2ea7458c96e94aa5fe7481e3f679a4c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2ea7458c96e94aa5fe7481e3f679a4c4">&#9670;&nbsp;</a></span>rdpq_passthrough_write</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define rdpq_passthrough_write</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">rdp_cmd</td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Write a passthrough RDP command into the rspq queue. </p>
<p >This macro handles writing a single RDP command into the rspq queue. It must be used only with raw commands aka passthroughs, that is commands that are not intercepted by RSP in any way, but just forwarded to RDP.</p>
<p >In block mode, the RDP command will be written to the static RDP buffer instead, so that it will be sent directly to RDP without going through RSP at all.</p>
<p >Example syntax (notice the double parenthesis): </p><pre class="fragment">rdpq_passthrough_write((RDPQ_CMD_SYNC_PIPE, 0, 0));
</pre> 
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a5e7cc732c607a8a3182c510e6c643fc6" name="a5e7cc732c607a8a3182c510e6c643fc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5e7cc732c607a8a3182c510e6c643fc6">&#9670;&nbsp;</a></span>__rdpq_block_begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_block_begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize RDP block mangament. </p>
<p >This is called by <a class="el" href="rspq_8h.html#a41f292fc1f7b261f84c55fc356f86acf" title="Begin creating a new block.">rspq_block_begin</a>. It resets all the block management state to default.</p>
<p >Notice that no allocation is performed. This is because we do block allocation lazily as soon as a rdpq command is issued. In fact, if the block does not contain rdpq commands, it would be a waste of time and memory to allocate a RDP buffer. The allocations will be performed by <a class="el" href="rdpq_8c.html#ab0187e0dcc3e6ef22ec15a36eabe1102" title="Allocate a new RDP block buffer, chaining it to the current one (if any)">__rdpq_block_next_buffer</a> as soon as a rdpq command is written.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="rspq_8h.html#a41f292fc1f7b261f84c55fc356f86acf" title="Begin creating a new block.">rspq_block_begin</a> </dd>
<dd>
<a class="el" href="rdpq_8c.html#ab0187e0dcc3e6ef22ec15a36eabe1102" title="Allocate a new RDP block buffer, chaining it to the current one (if any)">__rdpq_block_next_buffer</a> </dd></dl>

</div>
</div>
<a id="a0e87bea5a505bd42b36b0bd750b8c9c2" name="a0e87bea5a505bd42b36b0bd750b8c9c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0e87bea5a505bd42b36b0bd750b8c9c2">&#9670;&nbsp;</a></span>__rdpq_block_end()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> * __rdpq_block_end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Finish creation of a RDP block. </p>
<p >This is called by <a class="el" href="rspq_8h.html#a81339d69802148a09829d1c6d9a9f9f6" title="Finish creating a block.">rspq_block_end</a>. It finalizes block creation and return a pointer to the first node of the block, which will be put within the <a class="el" href="rspq__internal_8h.html#structrspq__block__t" title="A rspq block: pre-recorded array of commands.">rspq_block_t</a> structure, so to be able to reference it in <a class="el" href="rdpq_8c.html#a7e9fde5a3babeec454eb8ea92f390601" title="Run a block (called by rspq_block_run).">__rdpq_block_run</a> and <a class="el" href="rdpq_8c.html#a95f193ed65ef91d46599c3ca7edb1cc6" title="Free a block.">__rdpq_block_free</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>rdpq_block_t* The created block (first node)</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="rspq_8h.html#a81339d69802148a09829d1c6d9a9f9f6" title="Finish creating a block.">rspq_block_end</a> </dd>
<dd>
<a class="el" href="rdpq_8c.html#a7e9fde5a3babeec454eb8ea92f390601" title="Run a block (called by rspq_block_run).">__rdpq_block_run</a> </dd>
<dd>
<a class="el" href="rdpq_8c.html#a95f193ed65ef91d46599c3ca7edb1cc6" title="Free a block.">__rdpq_block_free</a> </dd></dl>

</div>
</div>
<a id="a95f193ed65ef91d46599c3ca7edb1cc6" name="a95f193ed65ef91d46599c3ca7edb1cc6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a95f193ed65ef91d46599c3ca7edb1cc6">&#9670;&nbsp;</a></span>__rdpq_block_free()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_block_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="rdpq__internal_8h.html#structrdpq__block__t">rdpq_block_t</a> *&#160;</td>
          <td class="paramname"><em>block</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a block. </p>
<p >This function is called when a block is freed. It is called by <a class="el" href="rspq_8h.html#aa1d3fe8768ca839b49421bf08ac5b5c2" title="Free a block that is not needed any more.">rspq_block_free</a>.</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="rspq_8h.html#aa1d3fe8768ca839b49421bf08ac5b5c2" title="Free a block that is not needed any more.">rspq_block_free</a>. </dd></dl>

</div>
</div>
<a id="ab0187e0dcc3e6ef22ec15a36eabe1102" name="ab0187e0dcc3e6ef22ec15a36eabe1102"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab0187e0dcc3e6ef22ec15a36eabe1102">&#9670;&nbsp;</a></span>__rdpq_block_next_buffer()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_block_next_buffer </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a new RDP block buffer, chaining it to the current one (if any) </p>
<p >This function is called by <a class="el" href="rdpq__internal_8h.html#a2ea7458c96e94aa5fe7481e3f679a4c4" title="Write a passthrough RDP command into the rspq queue.">rdpq_passthrough_write</a> and <a class="el" href="rdpq_8h.html#afa4205c5a6dbf58f7cb665a3c68d1991" title="Enqueue a RSP command that also generates RDP commands.">rdpq_write</a> when we are about to write a rdpq command in a block, and the current RDP buffer is full (<code>wptr + cmdsize &gt;= wend</code>). By extension, it is also called when the current RDP buffer has not been allocated yet (<code>wptr == wend == NULL</code>).</p>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="rdpq_8h.html#afa4205c5a6dbf58f7cb665a3c68d1991" title="Enqueue a RSP command that also generates RDP commands.">rdpq_write</a> </dd>
<dd>
<a class="el" href="rdpq__internal_8h.html#a2ea7458c96e94aa5fe7481e3f679a4c4" title="Write a passthrough RDP command into the rspq queue.">rdpq_passthrough_write</a> </dd></dl>

</div>
</div>
<a id="af94e0a9672c6ee667c9da808183cee7b" name="af94e0a9672c6ee667c9da808183cee7b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af94e0a9672c6ee667c9da808183cee7b">&#9670;&nbsp;</a></span>__rdpq_block_update()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_block_update </td>
          <td>(</td>
          <td class="paramtype">volatile uint32_t *&#160;</td>
          <td class="paramname"><em>wptr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set a new RDP write pointer, and enqueue a RSP command to run the buffer until there. </p>
<p >This function is called by <a class="el" href="rdpq__internal_8h.html#a2ea7458c96e94aa5fe7481e3f679a4c4" title="Write a passthrough RDP command into the rspq queue.">rdpq_passthrough_write</a> after some RDP commands have been written into the block's RDP buffer. A rspq command <a class="el" href="rspq__internal_8h.html#aba01db17f4a2bfbc3db60dc172972a25abe06e92ff0ad671b894d7406f36caf6a" title="RSPQ Command: send more data to RDP (appended to the end of the current buffer)">RSPQ_CMD_RDP_APPEND_BUFFER</a> will be issued so that the RSP will tell the RDP to fetch and run the new commands, appended at the end of the current buffer.</p>
<p >If possible, though, this function will coalesce the command with an immediately preceding RSPQ_CMD_RDP_APPEND_BUFFER (or even RSPQ_CMD_RDP_SET_BUFFER, if we are at the start of the buffer), so that only a single RSP command is issued, which covers multiple RDP commands.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">wptr</td><td>New block's RDP write pointer </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aa6f78d017798b8072f8006423f506e5f" name="aa6f78d017798b8072f8006423f506e5f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6f78d017798b8072f8006423f506e5f">&#9670;&nbsp;</a></span>__rdpq_block_reserve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_block_reserve </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>num_rdp_commands</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserve space in the RDP static buffer for a number of RDP commands. </p>
<p >This is called by <a class="el" href="rdpq_8h.html#afa4205c5a6dbf58f7cb665a3c68d1991" title="Enqueue a RSP command that also generates RDP commands.">rdpq_write</a> when run within a block. It makes sure that the static buffer has enough space for the specified number of RDP commands, and also switch back to the dynamic buffer if the command is going to generate a large or unbounded number of commands. </p>

</div>
</div>
<a id="a160540e0fbb288415a097fdbde5b8812" name="a160540e0fbb288415a097fdbde5b8812"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a160540e0fbb288415a097fdbde5b8812">&#9670;&nbsp;</a></span>__rdpq_autosync_change()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __rdpq_autosync_change </td>
          <td>(</td>
          <td class="paramtype">uint32_t&#160;</td>
          <td class="paramname"><em>res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Autosync engine: mark certain resources as being changed. </p>
<p >This is the core of the autosync engine. Whenever a resource is "changed" while "in use", a SYNC command must be issued. This is a slightly conservative approach, as the RDP might already have finished using that resource, but we have no way to know it. The SYNC command will then reset the "use" status of each respective resource. </p>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="a31b230c610daa5f50adaa7323ea2698b" name="a31b230c610daa5f50adaa7323ea2698b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a31b230c610daa5f50adaa7323ea2698b">&#9670;&nbsp;</a></span>__rdpq_inited</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool __rdpq_inited</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">extern</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>True if the rdpq module was inited. </p>
<p >True if the rdpq module was inited. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jun 5 2024 19:06:52 for libdragon by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
